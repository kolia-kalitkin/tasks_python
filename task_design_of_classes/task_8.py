# –ö–ª–∞—Å—Å FieldTrackerüå∂Ô∏èüå∂Ô∏è
# 
# –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–ª–∞—Å—Å FieldTracker, –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –∫–æ—Ç–æ—Ä–æ–≥–æ –ø–æ–ª—É—á–∞—é—Ç –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å —Å–æ—Å—Ç–æ—è–Ω–∏–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö –∞—Ç—Ä–∏–±—É—Ç–æ–≤ —Å–≤–æ–∏—Ö —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤ –∫–ª–∞—Å—Å–∞. –î–æ—á–µ—Ä–Ω–∏–µ –∫–ª–∞—Å—Å—ã –¥–æ–ª–∂–Ω—ã –Ω–∞—Å–ª–µ–¥–æ–≤–∞—Ç—å —á–µ—Ç—ã—Ä–µ –º–µ—Ç–æ–¥–∞ —ç–∫–∑–µ–º–ø–ª—è—Ä–∞:
#     base() ‚Äî –º–µ—Ç–æ–¥, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏–º—è –∞—Ç—Ä–∏–±—É—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π –ª–∏–±–æ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞, –ª–∏–±–æ –∏—Å—Ö–æ–¥–Ω–æ–µ (—É–∫–∞–∑–∞–Ω–Ω–æ–µ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏) –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ
#     has_changed() ‚Äî –º–µ—Ç–æ–¥, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏–º—è –∞—Ç—Ä–∏–±—É—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π True, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ —Ö–æ—Ç—è –±—ã —Ä–∞–∑, –∏–ª–∏ False –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ
#     changed() ‚Äî –º–µ—Ç–æ–¥, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å, –≤ –∫–æ—Ç–æ—Ä–æ–º –∫–ª—é—á–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è –∏–º–µ–Ω–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è–ª–∏ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ ‚Äî –∏—Ö –∏—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è
#     save() ‚Äî –º–µ—Ç–æ–¥, —Å–±—Ä–∞—Å—ã–≤–∞—é—â–∏–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ. –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è, —á—Ç–æ –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Ä–∞–Ω–µ–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–∏ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –∏—Ö —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–∏—Ç–∞—é—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–º–∏

# –ì–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç—Å—è, —á—Ç–æ –Ω–∞—Å–ª–µ–¥–Ω–∏–∫–∏ –∫–ª–∞—Å—Å–∞ FieldTracker:

#     –≤—Å–µ–≥–¥–∞ –∏–º–µ—é—Ç –∞—Ç—Ä–∏–±—É—Ç –∫–ª–∞—Å—Å–∞ fields, —Å–æ–¥–µ—Ä–∂–∞—â–∏–π –∫–æ—Ä—Ç–µ–∂ —Å –∞—Ç—Ä–∏–±—É—Ç–∞–º–∏, –∫–æ—Ç–æ—Ä—ã–µ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞—Ç—å
#     –≤ —Å–≤–æ–µ–º –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–µ –≤—Å–µ–≥–¥–∞ –≤—ã–∑—ã–≤–∞—é—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ç–æ—Ä –∫–ª–∞—Å—Å–∞ FieldTracker –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –ø–µ—Ä–≤–∏—á–Ω—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–µ–º—ã–º –∞—Ç—Ä–∏–±—É—Ç–∞–º


from typing import Any


class FieldTracker:
    def __init__(self) -> None:
        self.dict_attr = {name_attr: [value_attr] for name_attr, value_attr in self.__dict__.items()}     
        

    def __setattr__(self, name_attr: str, value_attr: Any) -> None:        
        if 'dict_attr' in self.__dict__:            
            self.dict_attr[name_attr].append(value_attr)     # –¥–æ–±–∞–≤–ª—è–µ–º –∏–∑–º–µ–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ     
        self.__dict__[name_attr] = value_attr

                
    def base(self, name_attr: str) -> int:
        """–º–µ—Ç–æ–¥, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏–º—è –∞—Ç—Ä–∏–±—É—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π –ª–∏–±–æ —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞, –ª–∏–±–æ –∏—Å—Ö–æ–¥–Ω–æ–µ (—É–∫–∞–∑–∞–Ω–Ω–æ–µ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏) –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞, –µ—Å–ª–∏ –æ–Ω–æ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ"""
        if len(self.dict_attr[name_attr]) > 1:
            return self.dict_attr[name_attr][0]     # –∏—Å—Ö–æ–¥–Ω–æ–µ (—É–∫–∞–∑–∞–Ω–Ω–æ–µ –ø—Ä–∏ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–∏)
        return getattr(self, name_attr, None)       # —Ç–µ–∫—É—â–µ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞

    
    def has_changed(self, name_attr: str) -> bool:
        """–º–µ—Ç–æ–¥, –ø—Ä–∏–Ω–∏–º–∞—é—â–∏–π –≤ –∫–∞—á–µ—Å—Ç–≤–µ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –∏–º—è –∞—Ç—Ä–∏–±—É—Ç–∞ –∏ –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π True, –µ—Å–ª–∏ –∑–Ω–∞—á–µ–Ω–∏–µ —ç—Ç–æ–≥–æ –∞—Ç—Ä–∏–±—É—Ç–∞ –±—ã–ª–æ –∏–∑–º–µ–Ω–µ–Ω–æ —Ö–æ—Ç—è –±—ã —Ä–∞–∑, –∏–ª–∏ False –≤ –ø—Ä–æ—Ç–∏–≤–Ω–æ–º —Å–ª—É—á–∞–µ"""       
        return len(self.dict_attr[name_attr]) > 1

    
    def changed(self) -> dict:
        """–º–µ—Ç–æ–¥, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–π —Å–ª–æ–≤–∞—Ä—å, –≤ –∫–æ—Ç–æ—Ä–æ–º –∫–ª—é—á–∞–º–∏ —è–≤–ª—è—é—Ç—Å—è –∏–º–µ–Ω–∞ –∞—Ç—Ä–∏–±—É—Ç–æ–≤, –∫–æ—Ç–æ—Ä—ã–µ –∏–∑–º–µ–Ω—è–ª–∏ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –∑–Ω–∞—á–µ–Ω–∏—è–º–∏ ‚Äî –∏—Ö –∏—Å—Ö–æ–¥–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏"""
        return {name_attr: value_attr[0] 
                for name_attr, value_attr in self.dict_attr.items() 
                if len(value_attr) > 1}

    
    def save(self) -> None:
        """–º–µ—Ç–æ–¥, —Å–±—Ä–∞—Å—ã–≤–∞—é—â–∏–π –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ. –ü–æ—Å–ª–µ –≤—ã–∑–æ–≤–∞ –º–µ—Ç–æ–¥–∞ —Å—á–∏—Ç–∞–µ—Ç—Å—è, —á—Ç–æ –≤—Å–µ –∞—Ç—Ä–∏–±—É—Ç—ã —Ä–∞–Ω–µ–µ –Ω–µ –∏–∑–º–µ–Ω—è–ª–∏ —Å–≤–æ–∏ –∑–Ω–∞—á–µ–Ω–∏—è, –∞ –∏—Ö —Ç–µ–∫—É—â–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Å—á–∏—Ç–∞—é—Ç—Å—è –∏—Å—Ö–æ–¥–Ω—ã–º–∏"""
        for value_attr in self.dict_attr.values():
            old_value = value_attr[0]  # —Å–æ—Ö—Ä–∞–Ω—è–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ –∞—Ç—Ä–∏–±—É—Ç–∞ 
            value_attr.clear()
            value_attr.append(old_value)


# --------—Ç–µ—Å—Ç -----------
class Point(FieldTracker):
    fields = ('x', 'y', 'z')

    def __init__(self, x, y, z):
        self.x, self.y, self.z = x, y, z
        super().__init__()

point = Point(1, 2, 3)
point.x = 0
point.z = 4
point.save()

print(point.base('x'))
print(point.base('z'))
print(point.has_changed('x'))
print(point.has_changed('z'))
print(point.changed())