# –ö–ª–∞—Å—Å Selfie üå∂Ô∏è
# 
# –†–µ–∞–ª–∏–∑—É–π—Ç–µ –∫–ª–∞—Å—Å Selfie, —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø–æ–º–∏–Ω–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —É–º–µ—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –¥–æ —Ç–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω–∏ –±—ã–ª–∏ —Ä–∞–Ω—å—à–µ. –ü–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞ –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π. –í–æ –≤—Ä–µ–º—è –∂–∏–∑–Ω–∏ —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ Selfie –º–æ–∂–µ—Ç —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ —Å–ø–æ—Å–æ–±–∞–º–∏ –∏–∑–º–µ–Ω—è—Ç—å —Å–≤–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä, –ø–æ–ª—É—á–∞—Ç—å –Ω–æ–≤—ã–µ –∞—Ç—Ä–∏–±—É—Ç—ã –∏–ª–∏ –∏–∑–º–µ–Ω—è—Ç—å –∑–Ω–∞—á–µ–Ω–∏—è –∏–º–µ—é—â–∏—Ö—Å—è:

# obj = Selfie()

# obj.x = 1
# obj.y = 2

# –î–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—Å–∞ Selfie –¥–æ–ª–∂–µ–Ω –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–µ—Ç–æ–¥ save_state(): 

# obj.save_state()              # —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ: x=1, y=2
# obj.x = 0                     # –∏–∑–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ
# obj.y = 0                     # –∏–∑–º–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ

# –ó–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—Å–∞ Selfie –¥–æ–ª–∂–Ω—ã –∏–Ω–¥–µ–∫—Å–∏—Ä–æ–≤–∞—Ç—å—Å—è: –ø–µ—Ä–≤–æ–µ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –∏–º–µ—Ç—å –∏–Ω–¥–µ–∫—Å 0, –≤—Ç–æ—Ä–æ–µ ‚Äî 1, —Ç—Ä–µ—Ç—å–µ ‚Äî 2, –∏ —Ç–∞–∫ –¥–∞–ª–µ–µ. –ü–æ —ç—Ç–∏–º –∂–µ –∏–Ω–¥–µ–∫—Å–∞–º –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –∫ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º —Å–æ—Å—Ç–æ—è–Ω–∏—è–º:

# print(obj.x)                  # 0
# print(obj.y)                  # 0
# obj = obj.recover_state(0)    # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º—Å—è –∫ –ø–µ—Ä–≤–æ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é
# print(obj.x)                  # 1
# print(obj.y)                  # 2

# –û–±—Ä–∞—Ç–∏—Ç–µ –≤–Ω–∏–º–∞–Ω–∏–µ, —á—Ç–æ –ø—Ä–∏ –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –∫ –æ–¥–Ω–æ–º—É –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–∞ recover_state() –¥–æ–ª–∂–µ–Ω –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å—Å—è –Ω–æ–≤—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ Selfie, –∏–º–µ—é—â–∏–π –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ. –ï—Å–ª–∏ –≤ –º–µ—Ç–æ–¥ recover_state() –ø–µ—Ä–µ–¥–∞–Ω –∏–Ω–¥–µ–∫—Å, –ø–æ –∫–æ—Ç–æ—Ä–æ–º—É —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ Selfie –Ω–µ –∏–º–µ–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏—è, –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤–æ–∑–≤—Ä–∞—â–µ–Ω —Ç–µ–∫—É—â–∏–π —ç–∫–∑–µ–º–ø–ª—è—Ä:

# obj = obj.recover_state(7)
# print(obj.x)                  # 1
# print(obj.y)                  # 2

# –ö–∞–∂–¥—ã–π —ç–∫–∑–µ–º–ø–ª—è—Ä –∫–ª–∞—Å—Å–∞ Selfie –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å, —Å–∫–æ–ª—å–∫–æ —Å–æ—Å—Ç–æ—è–Ω–∏–π –æ–Ω –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–ª:

# obj = Selfie()

# print(obj.n_states())         # 0
# obj.x = 0
# obj.save_state()
# obj.x = 1
# obj.save_state()
# obj.x = 2
# obj.save_state()
# print(obj.n_states())         # 3
# ------------------------------------------
import copy
from typing import TypeVar



Self = TypeVar("Self", bound="Selfie")

class Selfie:
    """
    –∫–ª–∞—Å—Å Selfie, —ç–∫–∑–µ–º–ø–ª—è—Ä—ã –∫–æ—Ç–æ—Ä–æ–≥–æ –∑–∞–ø–æ–º–∏–Ω–∞—é—Ç —Å–≤–æ–∏ –ø—Ä–µ–¥—ã–¥—É—â–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏—è –∏ —É–º–µ—é—Ç –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—Ç—å—Å—è –¥–æ —Ç–µ—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –æ–Ω–∏ –±—ã–ª–∏ —Ä–∞–Ω—å—à–µ. –ü–æ–¥ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º –æ–±—ä–µ–∫—Ç–∞ –ø–æ–Ω–∏–º–∞–µ—Ç—Å—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã–π –Ω–∞–±–æ—Ä –∞—Ç—Ä–∏–±—É—Ç–æ–≤ –∏ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∑–Ω–∞—á–µ–Ω–∏–π. 
    """
    
    def __init__(self) -> None:
        self.save_object = []

    
    def save_state(self) -> None:
        """–î–ª—è —Ñ–∏–∫—Å–∞—Ü–∏–∏ —Ç–µ–∫—É—â–µ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞ –∫–ª–∞—Å—Å–∞ Selfie"""       
        new_instance = copy.deepcopy(self)
        self.save_object.append(new_instance)
        
    
    def recover_state(self, index: int) -> Self:
        """–º–µ—Ç–æ–¥ –¥–ª—è –≤–æ–∑–≤—Ä–∞—â–µ–Ω–∏–∏ –∫ –æ–¥–Ω–æ–º—É –∏–∑ –ø—Ä–µ–¥—ã–¥—É—â–∏—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π"""               
        if self.save_object and abs(index) <= len(self.save_object) - 1:
            return self.save_object[index] 
        return self


    def n_states(self) -> int:
        """—É–∑–Ω–∞—Ç—å –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö —Å–æ—Å—Ç–æ—è–Ω–∏–π –¥–ª—è —ç–∫–∑–µ–º–ø–ª—è—Ä–∞"""        
        return len(self.save_object)

# ==========–∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ=======================
# import pickle
# class Selfie:
#     def __init__(self): self._states = []
#     def save_state(self): self._states.append(pickle.dumps(self))
#     def recover_state(self, n=0):
#         try: return pickle.loads(self._states[n])
#         except: return self
#     def n_states(self): return len(self._states)

# -----------—Ç–µ—Å—Ç—ã-------------------------------
print('------1 -------')
obj = Selfie()

obj.x = 1
obj.y = 2

print(obj.x)
print(obj.y)

obj.save_state()
obj.x = 0
obj.y = 0

print(obj.x)
print(obj.y)
obj = obj.recover_state(0)
print(obj.x)
print(obj.y)


print('------2 -------')
obj = Selfie()

print(obj.n_states())
obj.x = 0
obj.save_state()
obj.x = 1
obj.save_state()
obj.x = 2
obj.save_state()
print(obj.n_states())


print('------ 3-------')
from string import ascii_lowercase

obj = Selfie()
for char in ascii_lowercase:
    obj.__dict__[char] = ord(char)

print(*(obj.__dict__[char] for char in ascii_lowercase))
obj.save_state()

for char in ascii_lowercase:
    obj.__dict__[char] = ord(char) + 100

print(*(obj.__dict__[char] for char in ascii_lowercase))
obj = obj.recover_state(0)

print(*(obj.__dict__[char] for char in ascii_lowercase))


print('------ 4-------')
def sum_a_b(a, b):
    return a + b


def sub_a_b(a, b):
    return a - b


def mul_a_d(a, b):
    return a * b


def truediv_a_b(a, b):
    return a / b


obj = Selfie()
obj.sum_a_b = sum_a_b
print(obj.sum_a_b(1, 2))
obj.save_state()

obj.sub_a_b = sub_a_b
print(obj.sub_a_b(1, 2))
obj.save_state()

obj.mul_a_d = mul_a_d
print(obj.mul_a_d(1, 2))
obj.save_state()

obj.truediv_a_b = truediv_a_b
print(obj.truediv_a_b(1, 2))
obj.save_state()

print(obj.n_states())
obj = obj.recover_state(1)

print(obj.n_states())


print('------ 5-------')
obj = Selfie()

obj.x = 1
obj.y = 2

print(obj.x)
print(obj.y)

obj.x = 100
obj.y = 100

obj.save_state()
print(obj.x)
print(obj.y)

obj = obj.recover_state(7)
print(obj.x)
print(obj.y)